<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <title>Scaffolded Writing</title>
  <link rel="shortcut icon" type="image/png" href="https://freesvg.org/img/1392495957.png" />
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">Scaffolded Writing</span>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link</a>
        </li>
    </div>
  </nav>

  <div class="container">
    <div class="py-3">
      <h4>Problem Statement</h4>
      <p>Write a subproblem definition that can be used as the basis of a dynamic programming algorithm for this
        problem.</p>
      <blockquote style="padding-left: 1.4rem;  border-left: 4px solid #dadada;">
        You are planning a road trip along a highway with n evenly-spaced hotels; the costs of these hotels are provided
        in the array HotelCosts[1..n], such that HotelCosts[i] is the cost of the Hotel i. Each day, you can either
        travel to the next hotel, or you can skip a hotel and travel forward by two hotels. Each night, you must stay at
        a hotel. Furthermore, you have k coupons that allow you to stay at a hotel for free. Describe a dynamic
        programming algorithm to determine the minimum possible cost of traveling from Hotel 1 to Hotel n.
      </blockquote>
    </div>

    <div class="py-3">
      <h4>Your Response</h4>
      <p id="sentence"></p>
      <div class="input-group mb-3">
        <input type="text" class="form-control" id="next-token-input"
          placeholder="Type the next token of your sentence here!">
      </div>
      <button type="button" disabled class="btn btn-primary" id="submit">Submit</button>
      <button type="button" disabled class="btn btn-danger" id="delete">Delete Last Token</button>
    </div>

    <div class="py-3">
      <h4>Possible next tokens</h4>
      <h4 id="next-token-list" onselectstart="return false"></h4>
      <div id="no-more-tokens-message"></div>
    </div>

    <div class="py-3">
      <h4>Feedback</h4>
      <p id="feedback">Submit your response in order to receive feedback!</p>
      <div class="spinner-border text-secondary" style="display: none;" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
  </div>

  <!-- <div class="alert alert-secondary mt-5 pt-3" role="alert">
    <h5>Instructions and Tips</h5>
    <ul class="mt-1">
      <li>Type out the sentence one token at a time.
        (A token can be a word, phrase, mathematical expression, or punctuation mark.)</li>
      <li>At any point in the writing process, only a limited set of possibilities will be accepted as the next token.
        This scaffolding is intended to help you stay on track,
        and also to help ensure that the autograder can interpret what you wrote.</li>
      <li>When the token you have typed matches a token in the allowed set,
        it will automaticlaly be appended to the sentence, and you will be able to move on to the next token.</li>
      <li>Click DELETE LAST TOKEN to delete the last token of the sentence.
        (Unfortunately, deleting/inserting from the middle of the sentence is not supported.)</li>
      <li>Click SUBMIT when you are ready to get feedback on your sentence.
        (Note that you can only submit a complete sentence, i.e. a sentence that ends with a period.)</li>
    </ul>
  </div> -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="static/next_token_prediction.js"></script>
  <script>
    const START_STATE = 1;
    const END_STATE = 2;

    let curr_state = START_STATE;
    let entered_tokens = [];

    function updateNextTokenList() {
      const next_token_list = $('#next-token-list');
      const no_more_tokens_message = $('#no-more-tokens-message');

      next_token_list.empty();
      no_more_tokens_message.empty();

      $.each(Object.keys(fsm_json[curr_state]), (_, s) => {
        $('<span/>')
          .addClass('badge badge-dark m-2')
          .css('cursor', 'default')
          .text(s)
          .appendTo(next_token_list);
      });

      if (jQuery.isEmptyObject(fsm_json[curr_state])) {
        no_more_tokens_message.text('You have completed your sentence. No more tokens can be appended.');
      }
    }

    updateNextTokenList();

    function handleTokenEnteredOrDeleted() {
      curr_state = 1;
      for (const token of entered_tokens) {
        curr_state = fsm_json[curr_state][token];
      }

      $('#sentence').text(entered_tokens.join(' ').replace(' ,', ',').replace(' .', '.'));
      $('#delete').prop('disabled', entered_tokens.length === 0);
      $('#submit').prop('disabled', curr_state !== END_STATE);

      updateNextTokenList();
    }

    $('#next-token-input').keyup(e => {
      const processed_input = e.target.value.trim()
      if (processed_input in fsm_json[curr_state]) {
        entered_tokens.push(processed_input);
        e.target.value = '';
        handleTokenEnteredOrDeleted();
      }
    });

    $('#delete').click(e => {
      entered_tokens.pop();
      handleTokenEnteredOrDeleted();
    });

    $('#submit').click(async e => {
      $('#feedback').text('');
      $('.spinner-border').show();

      const response = await fetch('/submit', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(entered_tokens)
      });

      const feedback = await response.text();

      setTimeout(() => {
        $('#feedback').text(feedback);
        $('.spinner-border').hide();
      }, 1500)
    });
  </script>
</body>

</html>
